# README

Code Context for the video downloader projectt (AI assisted.)

## Codebase Context

The current Django-based video downloader application primarily functions through views defined in views.py within the downloader app. Here's a breakdown of how the site operates:

### Key Functionalities and Flow

1. Home Page:

- The home view renders the home page where users can navigate to download videos.

- See the code in views.py:

def home(request):

    return render(request, 'downloader/home.html')

2. Video Downloading:

- The download_video view handles the form where users submit a video URL for downloading. It uses yt_dlp for downloading and ffmpeg for audio extraction.

- The video and audio files are saved to the database and filesystem.

- See the code in views.py:

```python
def download_video(request):

            ...

            video.save()

            sanitized_title = sanitize_filename(info['title'])

                #Extract audio using FFmpeg

            stream = ffmpeg.input(video_path)

            audio_file = f"{sanitized_title}.m4a"

            audio_path = os.path.join(settings.MEDIA_ROOT, 'audios', audio_file)

            try:

                audio_stream = ffmpeg.output(stream, audio_path, acodec='libfdk_aac', audio_bitrate='192k')

                ffmpeg.run(audio_stream, overwrite_output=True)

            except ffmpeg.Error as e:

                error_message = str(e)

                print(f"FFmpeg error: {error_message}")

                video_audio_path = os.path.join(settings.MEDIA_ROOT, 'videos', audio_file)

                if os.path.exists(video_audio_path):

                    os.makedirs(os.path.dirname(audio_path), exist_ok=True)

                    shutil.move(video_audio_path, audio_path)

                    print(f"Audio file moved from 'videos' to 'audios' directory: {audio_file}")

                else:

                    return HttpResponse(f"Error: {error_message}")

            #Up[date the audio file path in the Video model

            video.audio_file.name = os.path.join('audios', audio_file)

            video.save()

            return redirect('video_detail',video_id=video.id)

        except (DownloadErr
```or, PostProcessingError) as e:

3. Video Detail and Pitch Shifting:

- The video_detail view displays details about the downloaded video, including options to pitch shift the audio.

- The pitch_shift view handles the pitch shifting functionality using ffmpeg.

- See the code in views.py:

```python
def pitch_shift(request, video_id):
```

        ...

### Supporting Files and Configuration

- URL Routing:

- URL patterns are defined in urls.py within the downloader app, directing HTTP requests to the appropriate views.

- See the code in urls.py:

```python
from django.urls import path

from django.contrib import admin

from . import views

urlpatterns = [

    path('admin/', admin.site.urls),

    path('', views.home, name='home'),

    path('download/', views.download_video, name='download_video'),

    path('video/<int:video_id>/', views.video_detail, name='video_detail'),
]
```

- Templates:

- HTML templates like home.html and video_detail.html define the structure and presentation of web pages.

- See the code in the templates directory:


```html
{% load static %}

<!DOCTYPE html>

<html>

<head>

    <meta charset ="UTF-8">

    <title>Video Downloader</title>

    <link rel ="stylesheet" type="text/css" href="{% static 'css/style.css' %}">

</head>

<body>

    <div class="'sidebar">    

    <h1>Welcome to Video Downloader</h1>

    <p>Download videos from YouTube and other supported platforms.</p>

    <a href="{% url 'download_video' %}">Download Video: Get Audio (.m4a)</a>

    </div>

</body>

</html>
```

- Settings and Deployment:

- Django settings (settings.py) configure the project, including database setup, installed apps, middleware, and template settings.

- See the code in settings.py:

```python
"""

Django settings for video_downloader project.



Generated by 'django-admin startproject' using Django 4.1.



For more information on this file, see

https://docs.djangoproject.com/en/4.1/topics/settings/



For the full list of settings and their values, see

https://docs.djangoproject.com/en/4.1/ref/settings/

"""

from pathlib import Path

import os



# Build paths inside the project like this: BASE_DIR / 'subdir'.

BASE_DIR = Path(__file__).resolve().parent.parent





# Quick-start development settings - unsuitable for production

# See https://docs.djangoproject.com/en/4.1/howto/deployment/checklist/



# SECURITY WARNING: keep the secret key used in production secret!

SECRET_KEY = "django-insecure-v7ge^k^b%m&dj=ka!ju9n%k%-&21t(jkn#a_q*wdw*g&oyt@4v"



# SECURITY WARNING: don't run with debug turned on in production!

DEBUG = True



ALLOWED_HOSTS = ['localhost', '127.0.0.1']





# Application definition



INSTALLED_APPS = [

    "django.contrib.admin",

    "django.contrib.auth",

    "django.contrib.contenttypes",

    "django.contrib.sessions",

    "django.contrib.messages",

    "django.contrib.staticfiles",

    "downloader",

]



MIDDLEWARE = [

    "django.middleware.security.SecurityMiddleware",

    "django.contrib.sessions.middleware.SessionMiddleware",

    "django.middleware.common.CommonMiddleware",

    "django.middleware.csrf.CsrfViewMiddleware",

    "django.contrib.auth.middleware.AuthenticationMiddleware",

    "django.contrib.messages.middleware.MessageMiddleware",

    "django.middleware.clickjacking.XFrameOptionsMiddleware",

]
```

- Static files (CSS) and media files (videos, audios) are managed through Django's static files system and the media root directory specified in the settings.

### Summary

The application leverages Django's MVC architecture where views.py acts as the controller handling business logic, templates act as the view for presentation, and models defined in models.py manage the data structure. The site's functionality is modularized into different views, each handling specific parts of the application's workflow, from video downloading to audio processing and user interaction through web pages.